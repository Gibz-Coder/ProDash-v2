<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Machine and Endtime Monitoring System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-dark: #0a1929;
        --bg-panel: #0d2137;
        --bg-card: #132f4c;
        --accent-cyan: #00d4ff;
        --accent-orange: #ff6b35;
        --accent-green: #00e676;
        --text-primary: #ffffff;
        --text-secondary: #b0bec5;
        --border-subtle: rgba(0, 212, 255, 0.2);
        --glow-cyan: rgba(0, 212, 255, 0.3);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Roboto", sans-serif;
        background: linear-gradient(135deg, var(--bg-dark) 0%, #0d2847 100%);
        color: var(--text-primary);
        padding: 15px;
        height: 100vh;
        display: flex;
        flex-direction: column;
        gap: 12px;
        overflow: hidden;
      }

      /* Header */
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: linear-gradient(
          90deg,
          var(--bg-panel) 0%,
          var(--bg-card) 100%
        );
        padding: 12px 24px;
        border-radius: 8px;
        border: 1px solid var(--border-subtle);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
      }

      h1 {
        font-size: 1.4rem;
        font-weight: 700;
        letter-spacing: 2px;
        text-transform: uppercase;
        background: linear-gradient(90deg, var(--accent-cyan), #ffffff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .header-buttons {
        display: flex;
        gap: 8px;
      }

      .btn {
        background: linear-gradient(135deg, var(--bg-card) 0%, #1a4a6e 100%);
        border: 1px solid var(--border-subtle);
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        color: var(--text-primary);
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
      }

      .btn:hover {
        background: linear-gradient(
          135deg,
          #1a4a6e 0%,
          var(--accent-cyan) 100%
        );
        box-shadow: 0 0 15px var(--glow-cyan);
        transform: translateY(-1px);
      }

      /* Main Grid */
      .main-grid {
        display: grid;
        grid-template-columns: 40fr 60fr;
        gap: 12px;
        flex: 1;
        min-height: 0;
      }

      /* Panel Styles */
      .panel {
        background: var(--bg-panel);
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        border: 1px solid var(--border-subtle);
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }

      .panel-header {
        background: linear-gradient(90deg, var(--bg-card) 0%, #1a4a6e 100%);
        color: var(--accent-cyan);
        padding: 10px 15px;
        font-weight: 700;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-bottom: 1px solid var(--border-subtle);
      }

      .panel-content {
        padding: 12px;
        flex-grow: 1;
        background: transparent;
      }

      /* Left Column */
      .left-col {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .machine-util {
        flex: 0 0 auto;
        display: flex;
        flex-direction: column;
        min-height: 360px;
      }

      .machine-util-content {
        display: flex;
        justify-content: space-between;
        align-items: stretch;
        padding: 12px;
        gap: 12px;
        height: 100%;
      }

      .chart-area {
        width: 50%;
        position: relative;
      }

      .switch-header {
        background: linear-gradient(
          135deg,
          var(--accent-cyan) 0%,
          #0099cc 100%
        );
        padding: 6px 10px;
        border-radius: 20px;
        text-align: center;
        margin-bottom: 5px;
        font-size: 0.65rem;
        font-weight: 700;
        color: #000;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 0 15px var(--glow-cyan);
      }

      .machine-type-status {
        flex: 0 0 auto;
      }

      /* Right Column */
      .right-col {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .right-col .panel {
        flex: 0 0 auto;
      }

      .ongoing-lots {
        height: auto;
        max-height: 127px;
      }

      /* Modern Table Styles */
      table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 0.75rem;
        color: var(--text-primary);
        background: transparent;
      }

      th,
      td {
        padding: 6px 8px;
        text-align: center;
        border: none;
      }

      th {
        background: linear-gradient(180deg, #1a4a6e 0%, var(--bg-card) 100%);
        font-weight: 700;
        color: var(--accent-cyan);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.7rem;
        border-bottom: 2px solid var(--accent-cyan);
      }

      tbody tr {
        background: rgba(255, 255, 255, 0.03);
        transition: all 0.2s ease;
      }

      tbody tr:nth-child(even) {
        background: rgba(0, 212, 255, 0.05);
      }

      tbody tr:hover {
        background: rgba(0, 212, 255, 0.15);
        box-shadow: inset 0 0 20px rgba(0, 212, 255, 0.1);
      }

      tbody td {
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        color: var(--text-secondary);
      }

      /* Total Row Highlight */
      tbody tr:last-child {
        background: linear-gradient(
          90deg,
          rgba(0, 212, 255, 0.4) 0%,
          rgba(0, 212, 255, 0.2) 100%
        );
        font-weight: 700;
      }

      tbody tr:last-child td {
        color: #ffffff;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        border-bottom: none;
      }

      /* Util Table */
      .util-table td {
        font-size: 0.8rem;
        padding: 3px 5px;
      }

      .util-table th {
        font-size: 0.7rem;
        padding: 4px 5px;
      }

      /* Highlight First Column globally */
      tbody td:first-child {
        background: rgba(0, 212, 255, 0.1);
        font-weight: 700;
        color: var(--accent-cyan);
      }

      /* Raw Data Section */
      .raw-data {
        height: 230px;
        display: flex;
        flex-direction: column;
      }

      .raw-data .panel-header {
        padding: 4px 10px;
        min-height: 35px;
        display: flex;
        align-items: center;
      }

      .raw-data-content th {
        position: sticky;
        top: 0;
        z-index: 10;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .search-input {
        padding: 8px 15px;
        border-radius: 20px;
        border: 1px solid var(--border-subtle);
        background: var(--bg-card);
        color: var(--text-primary);
        width: 200px;
        font-size: 0.8rem;
        transition: all 0.3s ease;
      }

      .search-input:focus {
        outline: none;
        border-color: var(--accent-cyan);
        box-shadow: 0 0 10px var(--glow-cyan);
      }

      .search-input::placeholder {
        color: var(--text-secondary);
      }

      .raw-data-content {
        overflow-y: auto;
        flex: 1;
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--bg-dark);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb {
        background: var(--accent-cyan);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #00b8e6;
      }

      /* Chart Legend Styles */
      .chart-legend {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 5px;
        padding: 5px 0;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.8rem;
        color: var(--text-primary);
        font-weight: 600;
      }

      .legend-badge {
        width: 12px;
        height: 12px;
        border-radius: 2px;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .legend-badge.run {
        background-color: #0f6b3d;
      }

      .legend-badge.wait {
        background-color: #e96a24;
      }

      /* Time Dropdown Styles */
      .time-dropdown {
        position: relative;
      }

      .time-select {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: 4px;
        color: var(--text-primary);
        padding: 2px 6px;
        font-size: 0.65rem;
        font-weight: 600;
        cursor: pointer;
        outline: none;
        transition: all 0.3s ease;
        min-width: 70px;
      }

      .time-select:hover {
        border-color: var(--accent-cyan);
        box-shadow: 0 0 5px var(--glow-cyan);
      }

      .time-select:focus {
        border-color: var(--accent-cyan);
        box-shadow: 0 0 8px var(--glow-cyan);
      }

      .time-select option {
        background: var(--bg-card);
        color: var(--text-primary);
        padding: 4px;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>MACHINE AND ENDTIME MONITORING SYSTEM</h1>
      <div class="header-buttons">
        <button class="btn">DATE PICKER</button>
        <button class="btn">MC STATUS</button>
        <button class="btn">WORKTYPE</button>
        <button class="btn">LOT TYPE</button>
        <button class="btn">REFRESH</button>
      </div>
    </header>

    <div class="main-grid">
      <!-- Left Column -->
      <div class="left-col">
        <!-- Machine Utilization -->
        <div class="panel machine-util">
          <div class="panel-header">Machine Utilization Status</div>
          <div
            class="panel-content machine-util-content"
            style="background: transparent; color: white"
          >
            <div
              class="chart-area"
              style="
                width: 50%;
                display: flex;
                flex-direction: column;
                height: 100%;
              "
            >
              <div class="switch-header">With toggle switch | Line A~K</div>
              <div style="flex: 1; position: relative; min-height: 0; padding: 2px;">
                <div id="utilizationGauge" style="width: 100%; height: 292px;"></div>
              </div>
              <div class="chart-legend">
                <div class="legend-item">
                  <div class="legend-badge run"></div>
                  <span>Run (80%)</span>
                </div>
                <div class="legend-item">
                  <div class="legend-badge wait"></div>
                  <span>Wait (20%)</span>
                </div>
              </div>
            </div>
            <div style="width: 48%; display: flex; flex-direction: column;">
              <table class="util-table" style="height: 100%;">
                <thead>
                  <tr>
                    <th>LINE</th>
                    <th>COUNT</th>
                    <th>RUN</th>
                    <th>WAIT</th>
                    <th>IDLE</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>A</td>
                    <td>33</td>
                    <td>21 ( 80% )</td>
                    <td>5 ( 20% )</td>
                    <td>0 ( 0% )</td>
                  </tr>
                  <tr>
                    <td>B</td>
                    <td>26</td>
                    <td>24 ( 80% )</td>
                    <td>6 ( 20% )</td>
                    <td>0 ( 0% )</td>
                  </tr>
                  <tr>
                    <td>C</td>
                    <td>29</td>
                    <td>20 ( 80% )</td>
                    <td>5 ( 20% )</td>
                    <td>0 ( 0% )</td>
                  </tr>
                  <tr>
                    <td>D</td>
                    <td>31</td>
                    <td>20 ( 80% )</td>
                    <td>5 ( 20% )</td>
                    <td>0 ( 0% )</td>
                  </tr>
                  <tr>
                    <td>E</td>
                    <td>30</td>
                    <td>26 ( 80% )</td>
                    <td>6 ( 20% )</td>
                    <td>0 ( 0% )</td>
                  </tr>
                  <tr>
                    <td>F</td>
                    <td>27</td>
                    <td>26 ( 80% )</td>
                    <td>6 ( 20% )</td>
                    <td>0 ( 0% )</td>
                  </tr>
                  <tr>
                    <td>G</td>
                    <td>29</td>
                    <td>21 ( 80% )</td>
                    <td>5 ( 20% )</td>
                    <td>0 ( 0% )</td>
                  </tr>
                  <tr>
                    <td>H</td>
                    <td>27</td>
                    <td>26 ( 80% )</td>
                    <td>6 ( 20% )</td>
                    <td>0 ( 0% )</td>
                  </tr>
                  <tr>
                    <td>I</td>
                    <td>29</td>
                    <td>20 ( 80% )</td>
                    <td>5 ( 20% )</td>
                    <td>0 ( 0% )</td>
                  </tr>
                  <tr>
                    <td>J</td>
                    <td>32</td>
                    <td>20 ( 80% )</td>
                    <td>5 ( 20% )</td>
                    <td>0 ( 0% )</td>
                  </tr>
                  <tr>
                    <td>K</td>
                    <td>28</td>
                    <td>26 ( 80% )</td>
                    <td>6 ( 20% )</td>
                    <td>0 ( 0% )</td>
                  </tr>
                  <tr style="font-weight: bold; background-color: #a4c2d6">
                    <td>TOTAL</td>
                    <td>321</td>
                    <td>260</td>
                    <td>65</td>
                    <td>0</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Status per Machine Type -->
        <div class="panel machine-type-status">
          <div class="panel-header">Status per Machine type</div>
          <div class="panel-content" style="padding: 0">
            <table class="status-table">
              <thead>
                <tr>
                  <th>ITEM</th>
                  <th>G20</th>
                  <th>G3</th>
                  <th>G1</th>
                  <th>TWA</th>
                  <th>WINTEC</th>
                  <th>TOTAL</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>RUN</td>
                  <td>26 ( 80% )</td>
                  <td>6 ( 20% )</td>
                  <td>0 ( 0% )</td>
                  <td>0 ( 0% )</td>
                  <td>0 ( 0% )</td>
                  <td>0 ( 0% )</td>
                </tr>
                <tr>
                  <td>WAIT</td>
                  <td>24 ( 80% )</td>
                  <td>6 ( 20% )</td>
                  <td>0 ( 0% )</td>
                  <td>0 ( 0% )</td>
                  <td>0 ( 0% )</td>
                  <td>0 ( 0% )</td>
                </tr>
                <tr>
                  <td>IDLE</td>
                  <td>24 ( 80% )</td>
                  <td>6 ( 20% )</td>
                  <td>0 ( 0% )</td>
                  <td>0 ( 0% )</td>
                  <td>0 ( 0% )</td>
                  <td>0 ( 0% )</td>
                </tr>
                <tr>
                  <td>TOTAL</td>
                  <td>20 ( 80% )</td>
                  <td>5 ( 20% )</td>
                  <td>0 ( 0% )</td>
                  <td>0 ( 0% )</td>
                  <td>0 ( 0% )</td>
                  <td>0 ( 0% )</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="right-col">
        <!-- Machine Utilization Trend -->
        <div class="panel ongoing-lots" style="height: 220px; overflow: visible; z-index: 999;">
          <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center; padding: 8px 15px;">
            <span>Machine Utilization Trend</span>
            <div class="time-dropdown">
              <select class="time-select">
                <option value="4h">4 Hours</option>
                <option value="2h">2 Hours</option>
                <option value="1h" selected>1 Hour</option>
                <option value="30m">30 Mins</option>
                <option value="15m">15 Mins</option>
                <option value="10m">10 Mins</option>
                <option value="5m">5 Mins</option>
              </select>
            </div>
          </div>
          <div class="panel-content" style="position: relative; padding: 2px; flex: 1; overflow: visible; z-index: 1000;">
            <canvas id="ongoingLotsChart" height="100" style="position: relative; z-index: 1001;"></canvas>
          </div>
        </div>

        <!-- Endtime remaining -->
        <div class="panel">
          <div class="panel-header">Endtime remaining</div>
          <div class="panel-content" style="padding: 0">
            <table>
              <thead>
                <tr>
                  <th>CLASS</th>
                  <th>COUNT</th>
                  <th>QTY</th>
                  <th>0603</th>
                  <th>1005</th>
                  <th>1608</th>
                  <th>2012</th>
                  <th>3216</th>
                  <th>3225</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>A | 0~1 HRS</td>
                  <td>84</td>
                  <td>339756</td>
                  <td>840236</td>
                  <td>665100</td>
                  <td>402229</td>
                  <td>279395</td>
                  <td>690013</td>
                  <td>600271</td>
                </tr>
                <tr>
                  <td>B | 1~3 HRS</td>
                  <td>29</td>
                  <td>61639</td>
                  <td>666947</td>
                  <td>238693</td>
                  <td>208819</td>
                  <td>455009</td>
                  <td>451819</td>
                  <td>103813</td>
                </tr>
                <tr>
                  <td>C | 3~6 HRS</td>
                  <td>58</td>
                  <td>100056</td>
                  <td>132894</td>
                  <td>709946</td>
                  <td>355762</td>
                  <td>55885</td>
                  <td>545127</td>
                  <td>563065</td>
                </tr>
                <tr>
                  <td>D | 6~â†‘ HRS</td>
                  <td>64</td>
                  <td>396347</td>
                  <td>436920</td>
                  <td>14485</td>
                  <td>520482</td>
                  <td>551344</td>
                  <td>509261</td>
                  <td>483740</td>
                </tr>
                <tr style="font-weight: bold">
                  <td>TOTAL</td>
                  <td>235</td>
                  <td>897798</td>
                  <td>2076997</td>
                  <td>1628224</td>
                  <td>1485292</td>
                  <td>1341613</td>
                  <td>2196220</td>
                  <td>1750889</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Endtime per cutoff -->
        <div class="panel">
          <div class="panel-header">Endtime per cutoff</div>
          <div class="panel-content" style="padding: 0">
            <table>
              <thead>
                <tr>
                  <th>CUTOFF</th>
                  <th>COUNT</th>
                  <th>QTY</th>
                  <th>0603</th>
                  <th>1005</th>
                  <th>1608</th>
                  <th>2012</th>
                  <th>3216</th>
                  <th>3225</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>00:00~03:59</td>
                  <td>85</td>
                  <td>324582</td>
                  <td>311520</td>
                  <td>268179</td>
                  <td>616632</td>
                  <td>359898</td>
                  <td>458685</td>
                  <td>111071</td>
                </tr>
                <tr>
                  <td>04:00~06:59</td>
                  <td>46</td>
                  <td>641106</td>
                  <td>549349</td>
                  <td>769511</td>
                  <td>583167</td>
                  <td>440602</td>
                  <td>566393</td>
                  <td>663288</td>
                </tr>
                <tr>
                  <td>07:00~11:59</td>
                  <td>49</td>
                  <td>281429</td>
                  <td>78420</td>
                  <td>550845</td>
                  <td>322786</td>
                  <td>68275</td>
                  <td>535009</td>
                  <td>706517</td>
                </tr>
                <tr>
                  <td>12:00~15:59</td>
                  <td>29</td>
                  <td>292625</td>
                  <td>603229</td>
                  <td>478035</td>
                  <td>336614</td>
                  <td>110232</td>
                  <td>219984</td>
                  <td>120465</td>
                </tr>
                <tr>
                  <td>16:00~18:59</td>
                  <td>78</td>
                  <td>229444</td>
                  <td>558220</td>
                  <td>84860</td>
                  <td>183711</td>
                  <td>78258</td>
                  <td>571363</td>
                  <td>712291</td>
                </tr>
                <tr>
                  <td>19:00~23:59</td>
                  <td>52</td>
                  <td>42155</td>
                  <td>456282</td>
                  <td>146427</td>
                  <td>473593</td>
                  <td>204282</td>
                  <td>15415</td>
                  <td>796026</td>
                </tr>
                <tr style="font-weight: bold">
                  <td>TOTAL</td>
                  <td>339</td>
                  <td>1811341</td>
                  <td>2557020</td>
                  <td>2297857</td>
                  <td>2516503</td>
                  <td>1261547</td>
                  <td>2366849</td>
                  <td>3109658</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Raw Data -->
    <div class="panel raw-data">
      <div
        class="panel-header"
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
        "
      >
        <span>Raw Data</span>
        <input type="text" placeholder="Search ...." class="search-input" />
      </div>
      <div class="panel-content raw-data-content" style="padding: 0">
        <table style="min-height: 100px">
          <thead>
            <tr>
              <th>NO</th>
              <th>MC NO.</th>
              <th>MC TYPE</th>
              <th>LINE</th>
              <th>AREA</th>
              <th>SIZE</th>
              <th>STATUS</th>
              <th>ELAPSED TIME</th>
              <th>LOT NO.</th>
              <th>MODEL</th>
              <th>WORKTYPE</th>
              <th>LIPAS</th>
              <th>START TIME</th>
              <th>ENDTIME</th>
              <th>SHARED MC</th>
              <th>REMARKS</th>
            </tr>
          </thead>
          <tbody>
            <!-- Empty rows as per image -->
            <tr>
              <td>1</td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>2</td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>3</td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>4</td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>5</td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>6</td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>7</td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>8</td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <script>
      // Utilization Gauge Chart (ECharts)
      document.addEventListener('DOMContentLoaded', function() {
        const utilizationGaugeElement = document.getElementById('utilizationGauge');
        if (utilizationGaugeElement) {
          const utilizationGaugeChart = echarts.init(utilizationGaugeElement);
          
          const utilizationGaugeOption = {
            series: [
              {
                name: 'Machine Utilization',
                type: 'gauge',
                min: 0,
                max: 100,
                radius: '100%',
                center: ['55%', '55%'],
                startAngle: 200,
                endAngle: -20,
                progress: {
                  show: true,
                  width: 21
                },
                axisLine: {
                  lineStyle: {
                    width: 22,
                    color: [
                      [0.8, '#0f6b3d'],
                      [1, '#e96a24']
                    ]
                  }
                },
                axisTick: {
                  distance: 12,
                  length: 8,
                  lineStyle: {
                    color: '#fff',
                    width: 2
                  }
                },
                splitLine: {
                  distance: 12,
                  length: 15,
                  lineStyle: {
                    color: '#fff',
                    width: 3
                  }
                },
                axisLabel: {
                  color: '#ffffff',
                  distance: 45,
                  fontSize: 11,
                  fontWeight: 'bold'
                },
                pointer: {
                  itemStyle: {
                    color: '#ffffff'
                  },
                  width: 5,
                  length: '70%'
                },
                detail: {
                  valueAnimation: true,
                  formatter: '{value}%',
                  color: '#ffffff',
                  fontSize: 22,
                  fontWeight: 'bold',
                  offsetCenter: [0, '50%']
                },
                title: {
                  fontSize: 16,
                  color: '#ffffff',
                  fontWeight: 'bold',
                  offsetCenter: [0, '70%']
                },
                data: [
                  {
                    value: 80,
                    name: '',
                    itemStyle: {
                      color: '#0f6b3d'
                    }
                  }
                ]
              }
            ]
          };
          
          utilizationGaugeChart.setOption(utilizationGaugeOption);
          window.addEventListener('resize', function() {
            utilizationGaugeChart.resize();
          });
        }
      });

      // Machine Utilization Trend Chart
      const ctxLots = document
        .getElementById("ongoingLotsChart")
        .getContext("2d");
      
      // Chart data for different time periods
      const chartData = {
        '4h': {
          labels: ['4h ago', '3.5h', '3h', '2.5h', '2h', '1.5h', '1h', '45m', '30m', '15m', '5m', 'Now'],
          datasets: [
            {
              label: "Running",
              data: [75, 78, 82, 85, 80, 77, 83, 88, 85, 82, 79, 81],
              backgroundColor: "#0f6b3d",
              borderColor: "#0f6b3d",
              borderWidth: 0,
            },
            {
              label: "Wait",
              data: [20, 18, 15, 12, 17, 20, 14, 10, 12, 15, 18, 16],
              backgroundColor: "#e96a24",
              borderColor: "#e96a24",
              borderWidth: 0,
            },
            {
              label: "Idle",
              data: [5, 4, 3, 3, 3, 3, 3, 2, 3, 3, 3, 3],
              backgroundColor: "#00a0e9",
              borderColor: "#00a0e9",
              borderWidth: 0,
            }
          ],
        },
        '2h': {
          labels: ['2h ago', '1h50m', '1h40m', '1h30m', '1h20m', '1h10m', '1h', '50m', '40m', '30m', '20m', 'Now'],
          datasets: [
            {
              label: "Running",
              data: [80, 82, 85, 83, 81, 84, 88, 85, 82, 79, 81, 83],
              backgroundColor: "#0f6b3d",
              borderColor: "#0f6b3d",
              borderWidth: 0,
            },
            {
              label: "Wait",
              data: [17, 15, 12, 14, 16, 13, 10, 12, 15, 18, 16, 14],
              backgroundColor: "#e96a24",
              borderColor: "#e96a24",
              borderWidth: 0,
            },
            {
              label: "Idle",
              data: [3, 3, 3, 3, 3, 3, 2, 3, 3, 3, 3, 3],
              backgroundColor: "#00a0e9",
              borderColor: "#00a0e9",
              borderWidth: 0,
            }
          ],
        },
        '1h': {
          labels: ['1h ago', '55m', '50m', '45m', '40m', '35m', '30m', '25m', '20m', '15m', '10m', 'Now'],
          datasets: [
            {
              label: "Running",
              data: [85, 83, 81, 84, 88, 85, 82, 79, 81, 83, 86, 84],
              backgroundColor: "#0f6b3d",
              borderColor: "#0f6b3d",
              borderWidth: 0,
            },
            {
              label: "Wait",
              data: [12, 14, 16, 13, 10, 12, 15, 18, 16, 14, 11, 13],
              backgroundColor: "#e96a24",
              borderColor: "#e96a24",
              borderWidth: 0,
            },
            {
              label: "Idle",
              data: [3, 3, 3, 3, 2, 3, 3, 3, 3, 3, 3, 3],
              backgroundColor: "#00a0e9",
              borderColor: "#00a0e9",
              borderWidth: 0,
            }
          ],
        },
        '30m': {
          labels: ['30m ago', '27.5m', '25m', '22.5m', '20m', '17.5m', '15m', '12.5m', '10m', '7.5m', '5m', 'Now'],
          datasets: [
            {
              label: "Running",
              data: [84, 88, 85, 82, 79, 81, 83, 86, 84, 87, 85, 83],
              backgroundColor: "#0f6b3d",
              borderColor: "#0f6b3d",
              borderWidth: 0,
            },
            {
              label: "Wait",
              data: [13, 10, 12, 15, 18, 16, 14, 11, 13, 10, 12, 14],
              backgroundColor: "#e96a24",
              borderColor: "#e96a24",
              borderWidth: 0,
            },
            {
              label: "Idle",
              data: [3, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
              backgroundColor: "#00a0e9",
              borderColor: "#00a0e9",
              borderWidth: 0,
            }
          ],
        },
        '15m': {
          labels: ['15m ago', '13.5m', '12m', '10.5m', '9m', '7.5m', '6m', '4.5m', '3m', '1.5m', '30s', 'Now'],
          datasets: [
            {
              label: "Running",
              data: [83, 86, 84, 87, 85, 83, 88, 86, 84, 82, 85, 87],
              backgroundColor: "#0f6b3d",
              borderColor: "#0f6b3d",
              borderWidth: 0,
            },
            {
              label: "Wait",
              data: [14, 11, 13, 10, 12, 14, 9, 11, 13, 15, 12, 10],
              backgroundColor: "#e96a24",
              borderColor: "#e96a24",
              borderWidth: 0,
            },
            {
              label: "Idle",
              data: [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
              backgroundColor: "#00a0e9",
              borderColor: "#00a0e9",
              borderWidth: 0,
            }
          ],
        },
        '10m': {
          labels: ['10m ago', '9m', '8m', '7m', '6m', '5m', '4m', '3m', '2m', '1m', '30s', 'Now'],
          datasets: [
            {
              label: "Running",
              data: [87, 85, 83, 88, 86, 84, 82, 85, 87, 89, 86, 84],
              backgroundColor: "#0f6b3d",
              borderColor: "#0f6b3d",
              borderWidth: 0,
            },
            {
              label: "Wait",
              data: [10, 12, 14, 9, 11, 13, 15, 12, 10, 8, 11, 13],
              backgroundColor: "#e96a24",
              borderColor: "#e96a24",
              borderWidth: 0,
            },
            {
              label: "Idle",
              data: [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
              backgroundColor: "#00a0e9",
              borderColor: "#00a0e9",
              borderWidth: 0,
            }
          ],
        },
        '5m': {
          labels: ['5m ago', '4.5m', '4m', '3.5m', '3m', '2.5m', '2m', '1.5m', '1m', '30s', '15s', 'Now'],
          datasets: [
            {
              label: "Running",
              data: [84, 82, 85, 87, 89, 86, 84, 88, 85, 83, 86, 88],
              backgroundColor: "#0f6b3d",
              borderColor: "#0f6b3d",
              borderWidth: 0,
            },
            {
              label: "Wait",
              data: [13, 15, 12, 10, 8, 11, 13, 9, 12, 14, 11, 9],
              backgroundColor: "#e96a24",
              borderColor: "#e96a24",
              borderWidth: 0,
            },
            {
              label: "Idle",
              data: [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
              backgroundColor: "#00a0e9",
              borderColor: "#00a0e9",
              borderWidth: 0,
            }
          ],
        }
      };

      let utilizationTrendChart = new Chart(ctxLots, {
        type: "bar",
        data: chartData['1h'], // Default to 1 hour
        plugins: [ChartDataLabels],
        options: {
          responsive: true,
          maintainAspectRatio: false,
          layout: {
            padding: {
              top: 5,
              bottom: 15,
              left: 5,
              right: 5
            }
          },
          barPercentage: 0.6,
          categoryPercentage: 0.8,
          interaction: {
            intersect: false,
            mode: 'index'
          },
          scales: {
            x: {
              stacked: true,
              ticks: { 
                color: "#ffffff",
                font: { size: 9, weight: '600' },
                maxRotation: 0,
                minRotation: 0,
                padding: 2
              },
              grid: { 
                display: false 
              },
              border: {
                color: 'rgba(176, 190, 197, 0.2)'
              }
            },
            y: {
              stacked: true,
              display: true,
              beginAtZero: true,
              max: 100,
              ticks: {
                color: "#b0bec5",
                font: { size: 8 },
                padding: 3,
                callback: function(value) {
                  return value + '%';
                }
              },
              grid: {
                color: 'rgba(176, 190, 197, 0.1)',
                lineWidth: 1
              },
              border: {
                color: 'rgba(176, 190, 197, 0.2)'
              }
            },
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(13, 33, 55, 0.95)',
              titleColor: '#00d4ff',
              bodyColor: '#ffffff',
              borderColor: '#00d4ff',
              borderWidth: 1,
              cornerRadius: 6,
              displayColors: true,
              position: 'nearest',
              yAlign: 'bottom',
              caretPadding: 10,
              callbacks: {
                title: function(context) {
                  return 'Time: ' + context[0].label;
                },
                label: function(context) {
                  return context.dataset.label + ': ' + context.parsed.y + '%';
                }
              }
            },
            datalabels: {
              display: true,
              color: 'white',
              font: {
                size: 8,
                weight: 'bold'
              },
              formatter: function(value, context) {
                // Only show label if value is significant enough (> 5%)
                return value > 5 ? value + '%' : '';
              },
              anchor: 'center',
              align: 'center'
            }
          },
          elements: {
            bar: {
              borderRadius: {
                topLeft: 2,
                topRight: 2,
                bottomLeft: 0,
                bottomRight: 0
              }
            }
          }
        },
      });

      // Handle dropdown change
      document.querySelector('.time-select').addEventListener('change', function(e) {
        const selectedTime = e.target.value;
        utilizationTrendChart.data = chartData[selectedTime];
        utilizationTrendChart.update('active');
      });
    </script>
  </body>
</html>
